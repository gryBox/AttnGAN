- model: damsm
  description: Deep Attentional Multimodal Similarity Model (DAMSM)
  operations:

    pretrain:
      description: Pretrain the DAMSM model
      main: pretrain_DAMSM --data_dir data/photosynthesis --output_dir output
      flags-import: no

      flags:
        epochs:
          description: Number of epochs to run
          arg-name: max_epoch
          default: 201  # So the last trained model can be captured
        gamma1:
          description: Smooth gamma1
          default: 72.4953
          type: float
        gamma2:
          description: Smooth gamma2
          default: 65.3585
          type: float
        gamma3:
          description: Smooth gamma3
          default: 50.0
          type: float
        encoder_lr:
          description: ENCODER_LR
          default: 0.003189
          type: float
        embedding_dim:
          description: EMBEDDING_DIM
          default: 1024
          type: int
        rnn_grad_clip:
          description: RNN_GRAD_CLIP
          default: 2.0
          type: float

      requires:
        - file: ../data
        - file: cfg

      output-scalars:
        step: 'end epoch +([0-9]+)'
        s_loss: 'valid loss +([0-9\.]+)'
        w_loss: 'valid loss +[0-9\.]+ +([0-9\.]+)'

      compare:
        - =gamma1
        - s_loss step as step
        - s_loss
        - w_loss

      objective: s_loss

    # train:
    #   description: Train the DAMSM model
    #   #main: main
    #   exec: echo train

    #all:
    #  description: Run all steps for building model start to finish
    #  steps:
    #    - run: pretrain
    #    #- run: train
